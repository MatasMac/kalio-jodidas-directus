var e=((e,s,a=500)=>class extends Error{name="DirectusError";extensions;code=e.toUpperCase();status=a;constructor(e,a){super("string"==typeof s?s:s(e),a),this.extensions=e}toString(){return`${this.name} [${this.code}]: ${this.message}`}})("INVALID_PAYLOAD",(({reason:e})=>`Invalid payload. ${e}.`),400),s=({filter:s},{services:a})=>{const{ItemsService:t}=a;async function r(s,a,r){if("journal"===a&&s?.personal_code){const a=s.personal_code;if(!s.no_lt_personal_code&&!function(e){const s=[1,2,3,4,5,6,7,8,9,1],a=[3,4,5,6,7,8,9,1,2,3],t=e.split("").map(Number),r=t[10];let n=t.slice(0,10).reduce(((e,a,t)=>e+a*s[t]),0),i=n%11;if(10===i){let e=t.slice(0,10).reduce(((e,s,t)=>e+s*a[t]),0),s=e%11;return s===r||10===s&&0===r}return i===r}(a))throw new e({reason:"Asmens kodas neteisingo formato"});const n=await async function(e,s){const a=new t("journal",{schema:s}),r=await a.readByQuery({filter:{personal_code:e,status:"issued"},limit:1,fields:["personal_code","pharmacy_unit.address","pharmacy_unit.pharmacy.title"]});if(r.length>0)return{exists:!0,address:r[0].pharmacy_unit?.address||null,pharmacy:r[0].pharmacy_unit?.pharmacy?.title||null};return{exists:!1,address:null}}(a,r);if(n.exists)throw new e({reason:`Asmens kodas rastas kitoje vaistinėje. ${n.pharmacy?`Vaistinė: ${n.pharmacy}.`:""} ${n.address?` Adresas: ${n.address}`:""}`})}}s("items.create",(async(e,{collection:s},{schema:a})=>(await r(e,s,a),e))),s("items.update",(async(e,{collection:s},{schema:a})=>(await r(e,s,a),e)))};export{s as default};
